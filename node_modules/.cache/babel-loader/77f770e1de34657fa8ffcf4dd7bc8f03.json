{"ast":null,"code":"var _jsxFileName = \"/home/conan/mars_rover/src/RoversGrid/RoversGrid.tsx\",\n    _s = $RefreshSig$();\n\nimport Papa from \"papaparse\";\nimport React, { useEffect, useReducer } from \"react\";\nimport startRover from \"../Rover/rover\";\nimport \"./rover-grid.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport function processRovers(rovers) {\n  return rovers.map(data => {\n    // The format of the data require us to split on different cases\n    const [x, y, direction] = data[0].split(\" \");\n    const mainCommands = data[1].split(\"\");\n    return {\n      initialPosition: {\n        x: parseInt(x),\n        y: parseInt(y),\n        direction: direction\n      },\n      commands: mainCommands\n    };\n  });\n}\n\nasync function fetchCsv(dispatch, csvAddress) {\n  const response = await fetch(csvAddress);\n\n  if (response.body != null) {\n    const reader = response.body.getReader();\n    const result = await reader.read();\n    const decoder = new TextDecoder(\"utf-8\");\n    const csv = await decoder.decode(result.value);\n    Papa.parse(csv, {\n      skipEmptyLines: true,\n      complete: ({\n        data\n      }) => {\n        dispatch({\n          type: \"loaded_rovers\",\n          payload: processRovers(data)\n        });\n      }\n    });\n  }\n}\n\nfunction reducer(state, action) {\n  switch (action.type) {\n    case \"loaded_rovers\":\n      return { ...state,\n        roversLeft: action.payload\n      };\n\n    case \"change_rovers\":\n      return { ...state,\n        roversLeft: [...state.roversLeft.slice(1)],\n        existingRoversPosition: [...state.existingRoversPosition, action.payload]\n      };\n  }\n}\n\nfunction RoversGrid({\n  maxTerrainSize,\n  csvAddress\n}) {\n  _s();\n\n  const [{\n    existingRoversPosition,\n    roversLeft\n  }, dispatch] = useReducer(reducer, {\n    existingRoversPosition: [],\n    roversLeft: []\n  });\n  useEffect(() => {\n    fetchCsv(dispatch, csvAddress);\n  }, [csvAddress]);\n  useEffect(() => {\n    if (roversLeft.length > 0) {\n      const currentRover = roversLeft[0];\n      const roverFinalPosition = startRover(maxTerrainSize, currentRover.initialPosition, currentRover.commands, existingRoversPosition);\n      dispatch({\n        type: \"change_rovers\",\n        payload: roverFinalPosition\n      });\n    }\n  }, [existingRoversPosition, maxTerrainSize, roversLeft]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"App\",\n    children: [...Array(maxTerrainSize.x)].reverse().map((e, i) => {\n      debugger;\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"container\",\n        children: [...Array.from({\n          length: maxTerrainSize.y\n        }, (x, i) => i)].reverse().map((e, j) => {\n          debugger;\n          const roverHere = existingRoversPosition.findIndex(rover => {\n            return rover.x === i && rover.y === j;\n          });\n          return roverHere !== -1 ? /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"cell occupied\",\n            children: [\"Rover \", roverHere + 1]\n          }, `row-${i}-col-${j}`, true, {\n            fileName: _jsxFileName,\n            lineNumber: 113,\n            columnNumber: 19\n          }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"cell\",\n            children: \"\\xA0\"\n          }, `row-${i}-col-${j}`, false, {\n            fileName: _jsxFileName,\n            lineNumber: 117,\n            columnNumber: 19\n          }, this);\n        })\n      }, `row-${i}`, false, {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 11\n      }, this);\n    })\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 99,\n    columnNumber: 5\n  }, this);\n}\n\n_s(RoversGrid, \"xcfIFu9ozLAMWCofSJumnmxKTRQ=\");\n\n_c = RoversGrid;\nexport default RoversGrid;\n\nvar _c;\n\n$RefreshReg$(_c, \"RoversGrid\");","map":{"version":3,"sources":["/home/conan/mars_rover/src/RoversGrid/RoversGrid.tsx"],"names":["Papa","React","useEffect","useReducer","startRover","processRovers","rovers","map","data","x","y","direction","split","mainCommands","initialPosition","parseInt","commands","fetchCsv","dispatch","csvAddress","response","fetch","body","reader","getReader","result","read","decoder","TextDecoder","csv","decode","value","parse","skipEmptyLines","complete","type","payload","reducer","state","action","roversLeft","slice","existingRoversPosition","RoversGrid","maxTerrainSize","length","currentRover","roverFinalPosition","Array","reverse","e","i","from","j","roverHere","findIndex","rover"],"mappings":"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","sourcesContent":["import Papa from \"papaparse\";\nimport React, { Dispatch, Reducer, useEffect, useReducer } from \"react\";\nimport startRover from \"../Rover/rover\";\nimport { Command, Direction } from \"../Rover/rover.types\";\nimport \"./rover-grid.css\";\nimport {\n  Action,\n  Data,\n  RoversGridProps,\n  State,\n  UndeployedRover,\n} from \"./roverGrid.types\";\n\nexport function processRovers(rovers: string[][]): UndeployedRover[] {\n  return rovers.map((data) => {\n    // The format of the data require us to split on different cases\n    const [x, y, direction] = data[0].split(\" \");\n    const mainCommands = data[1].split(\"\");\n\n    return {\n      initialPosition: {\n        x: parseInt(x),\n        y: parseInt(y),\n        direction: direction as Direction,\n      },\n      commands: mainCommands as Command[],\n    };\n  });\n}\n\nasync function fetchCsv(dispatch: Dispatch<Action>, csvAddress: string) {\n  const response = await fetch(csvAddress);\n\n  if (response.body != null) {\n    const reader = response.body.getReader();\n    const result = await reader.read();\n    const decoder = new TextDecoder(\"utf-8\");\n    const csv = await decoder.decode(result.value);\n\n    Papa.parse(csv, {\n      skipEmptyLines: true,\n      complete: ({ data }: Data) => {\n        dispatch({\n          type: \"loaded_rovers\",\n          payload: processRovers(data),\n        });\n      },\n    });\n  }\n}\n\nfunction reducer(state: State, action: Action): State {\n  switch (action.type) {\n    case \"loaded_rovers\":\n      return {\n        ...state,\n        roversLeft: action.payload,\n      };\n    case \"change_rovers\":\n      return {\n        ...state,\n        roversLeft: [...state.roversLeft.slice(1)],\n        existingRoversPosition: [\n          ...state.existingRoversPosition,\n          action.payload,\n        ],\n      };\n  }\n}\n\nfunction RoversGrid({ maxTerrainSize, csvAddress }: RoversGridProps) {\n  const [{ existingRoversPosition, roversLeft }, dispatch] = useReducer<\n    Reducer<State, Action>\n  >(reducer, {\n    existingRoversPosition: [],\n    roversLeft: [],\n  });\n\n  useEffect(() => {\n    fetchCsv(dispatch, csvAddress);\n  }, [csvAddress]);\n\n  useEffect(() => {\n    if (roversLeft.length > 0) {\n      const currentRover = roversLeft[0];\n\n      const roverFinalPosition = startRover(\n        maxTerrainSize,\n        currentRover.initialPosition,\n        currentRover.commands,\n        existingRoversPosition\n      );\n\n      dispatch({ type: \"change_rovers\", payload: roverFinalPosition });\n    }\n  }, [existingRoversPosition, maxTerrainSize, roversLeft]);\n\n  return (\n    <div className=\"App\">\n      {[...Array(maxTerrainSize.x)].reverse().map((e, i) => {\n        debugger;\n        return (\n          <div className=\"container\" key={`row-${i}`}>\n            {[...Array.from({ length: maxTerrainSize.y }, (x, i) => i)]\n              .reverse()\n              .map((e, j) => {\n                debugger;\n\n                const roverHere = existingRoversPosition.findIndex((rover) => {\n                  return rover.x === i && rover.y === j;\n                });\n                return roverHere !== -1 ? (\n                  <div className=\"cell occupied\" key={`row-${i}-col-${j}`}>\n                    Rover {roverHere + 1}\n                  </div>\n                ) : (\n                  <div className=\"cell\" key={`row-${i}-col-${j}`}>\n                    &nbsp;\n                  </div>\n                );\n              })}\n          </div>\n        );\n      })}\n    </div>\n  );\n}\n\nexport default RoversGrid;\n"]},"metadata":{},"sourceType":"module"}