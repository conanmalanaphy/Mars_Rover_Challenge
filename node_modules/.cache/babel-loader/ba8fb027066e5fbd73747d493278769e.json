{"ast":null,"code":"var _jsxFileName = \"/home/conan/mars_rover/src/RoversGrid/RoversGrid.tsx\",\n    _s = $RefreshSig$();\n\nimport Papa from \"papaparse\";\nimport React, { useEffect, useReducer } from \"react\";\nimport startRover from \"../Rover/rover\";\nimport \"./rover-grid.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport function processRovers(rovers) {\n  debugger;\n  return rovers.map(data => {\n    const [x, y, direction] = data[0].substring(1).split(\" \");\n    const mainCommands = data[1].slice(1, -1).split(\"\");\n    return {\n      initialPosition: {\n        x: parseInt(x),\n        y: parseInt(y),\n        direction: direction\n      },\n      commands: mainCommands\n    };\n  });\n}\n\nasync function fetchCsv(dispatch, csvAddress) {\n  const response = await fetch(csvAddress);\n\n  if (response.body != null) {\n    const reader = response.body.getReader();\n    const result = await reader.read();\n    const decoder = new TextDecoder(\"utf-8\");\n    const csv = await decoder.decode(result.value);\n    Papa.parse(csv, {\n      skipEmptyLines: true,\n      complete: ({\n        data\n      }) => {\n        const processedRovers = processRovers(data);\n        dispatch({\n          type: \"loaded_rovers\",\n          payload: processedRovers\n        });\n      }\n    });\n  }\n}\n\nfunction reducer(state, action) {\n  switch (action.type) {\n    case \"loaded_rovers\":\n      return { ...state,\n        roversLeft: action.payload\n      };\n\n    case \"change_rovers\":\n      return { ...state,\n        roversLeft: [...state.roversLeft.slice(1)],\n        existingRoversPosition: [...state.existingRoversPosition, action.payload]\n      };\n  }\n}\n\nfunction RoversGrid({\n  maxTerrainSize,\n  csvAddress\n}) {\n  _s();\n\n  const [{\n    existingRoversPosition,\n    roversLeft\n  }, dispatch] = useReducer(reducer, {\n    existingRoversPosition: [],\n    roversLeft: []\n  });\n  useEffect(() => {\n    fetchCsv(dispatch, csvAddress);\n  }, [csvAddress]);\n  useEffect(() => {\n    // When roversLeft have\n    if (roversLeft.length > 0) {\n      const currentRover = roversLeft[0];\n      const roverFinalPosition = startRover(maxTerrainSize, currentRover.initialPosition, currentRover.commands, existingRoversPosition);\n      dispatch({\n        type: \"change_rovers\",\n        payload: roverFinalPosition\n      });\n    }\n  }, [existingRoversPosition, maxTerrainSize, roversLeft]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"App\",\n    children: [...Array(maxTerrainSize.x)].map((e, i) => {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"container\",\n        children: [...Array(maxTerrainSize.y)].map((e, j) => {\n          const roverHere = existingRoversPosition.findIndex(rover => {\n            return rover.x === i && rover.y === j;\n          });\n          return roverHere !== -1 ? /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"cell occupied\",\n            children: [\"Rover \", roverHere + 1]\n          }, `row-${i}-col-${j}`, true, {\n            fileName: _jsxFileName,\n            lineNumber: 110,\n            columnNumber: 17\n          }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"cell\",\n            children: \"\\xA0\"\n          }, `row-${i}-col-${j}`, false, {\n            fileName: _jsxFileName,\n            lineNumber: 114,\n            columnNumber: 17\n          }, this);\n        })\n      }, `row-${i}`, false, {\n        fileName: _jsxFileName,\n        lineNumber: 104,\n        columnNumber: 11\n      }, this);\n    })\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 101,\n    columnNumber: 5\n  }, this);\n}\n\n_s(RoversGrid, \"xcfIFu9ozLAMWCofSJumnmxKTRQ=\");\n\n_c = RoversGrid;\nexport default RoversGrid;\n\nvar _c;\n\n$RefreshReg$(_c, \"RoversGrid\");","map":{"version":3,"sources":["/home/conan/mars_rover/src/RoversGrid/RoversGrid.tsx"],"names":["Papa","React","useEffect","useReducer","startRover","processRovers","rovers","map","data","x","y","direction","substring","split","mainCommands","slice","initialPosition","parseInt","commands","fetchCsv","dispatch","csvAddress","response","fetch","body","reader","getReader","result","read","decoder","TextDecoder","csv","decode","value","parse","skipEmptyLines","complete","processedRovers","type","payload","reducer","state","action","roversLeft","existingRoversPosition","RoversGrid","maxTerrainSize","length","currentRover","roverFinalPosition","Array","e","i","j","roverHere","findIndex","rover"],"mappings":"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","sourcesContent":["import Papa from \"papaparse\";\nimport React, { Dispatch, Reducer, useEffect, useReducer } from \"react\";\nimport startRover from \"../Rover/rover\";\nimport { Command, Direction } from \"../Rover/rover.types\";\nimport \"./rover-grid.css\";\nimport {\n  Action,\n  Data,\n  RoversGridProps,\n  State,\n  UndeployedRover,\n} from \"./roverGrid.types\";\n\nexport function processRovers(rovers: string[][]) {\n  debugger;\n  return rovers.map((data) => {\n    const [x, y, direction] = data[0].substring(1).split(\" \");\n    const mainCommands = data[1].slice(1, -1).split(\"\");\n\n    return {\n      initialPosition: {\n        x: parseInt(x),\n        y: parseInt(y),\n        direction: direction as Direction,\n      },\n      commands: mainCommands as Command[],\n    };\n  });\n}\n\nasync function fetchCsv(dispatch: Dispatch<Action>, csvAddress: string) {\n  const response = await fetch(csvAddress);\n\n  if (response.body != null) {\n    const reader = response.body.getReader();\n    const result = await reader.read();\n    const decoder = new TextDecoder(\"utf-8\");\n    const csv = await decoder.decode(result.value);\n\n    Papa.parse(csv, {\n      skipEmptyLines: true,\n      complete: ({ data }: Data) => {\n        const processedRovers = processRovers(data);\n        dispatch({\n          type: \"loaded_rovers\",\n          payload: processedRovers as UndeployedRover[],\n        });\n      },\n    });\n  }\n}\n\nfunction reducer(state: State, action: Action): State {\n  switch (action.type) {\n    case \"loaded_rovers\":\n      return {\n        ...state,\n        roversLeft: action.payload,\n      };\n    case \"change_rovers\":\n      return {\n        ...state,\n        roversLeft: [...state.roversLeft.slice(1)],\n        existingRoversPosition: [\n          ...state.existingRoversPosition,\n          action.payload,\n        ],\n      };\n  }\n}\n\nfunction RoversGrid({ maxTerrainSize, csvAddress }: RoversGridProps) {\n  const [{ existingRoversPosition, roversLeft }, dispatch] = useReducer<\n    Reducer<State, Action>\n  >(reducer, {\n    existingRoversPosition: [],\n    roversLeft: [],\n  });\n\n  useEffect(() => {\n    fetchCsv(dispatch, csvAddress);\n  }, [csvAddress]);\n\n  useEffect(() => {\n    // When roversLeft have\n    if (roversLeft.length > 0) {\n      const currentRover = roversLeft[0];\n\n      const roverFinalPosition = startRover(\n        maxTerrainSize,\n        currentRover.initialPosition,\n        currentRover.commands,\n        existingRoversPosition\n      );\n\n      dispatch({ type: \"change_rovers\", payload: roverFinalPosition });\n    }\n  }, [existingRoversPosition, maxTerrainSize, roversLeft]);\n\n  return (\n    <div className=\"App\">\n      {[...Array(maxTerrainSize.x)].map((e, i) => {\n        return (\n          <div className=\"container\" key={`row-${i}`}>\n            {[...Array(maxTerrainSize.y)].map((e, j) => {\n              const roverHere = existingRoversPosition.findIndex((rover) => {\n                return rover.x === i && rover.y === j;\n              });\n              return roverHere !== -1 ? (\n                <div className=\"cell occupied\" key={`row-${i}-col-${j}`}>\n                  Rover {roverHere + 1}\n                </div>\n              ) : (\n                <div className=\"cell\" key={`row-${i}-col-${j}`}>\n                  &nbsp;\n                </div>\n              );\n            })}\n          </div>\n        );\n      })}\n    </div>\n  );\n}\n\nexport default RoversGrid;\n"]},"metadata":{},"sourceType":"module"}